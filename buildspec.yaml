version: 0.2

phases:
  install:
    commands:
        - sudo apt-get install python3
        - python3 -m pip install -r requirements.txt
        - sudo apt-get install libgtest-dev && cd /usr/src/gtest && sudo cmake CMakeLists.txt && sudo make && sudo cp lib/libgtest* /usr/lib/ && sudo mkdir /usr/local/lib/googletest && sudo ln -s /usr/lib/libgtest.a /usr/local/lib/libgtest.a && sudo ln -s /usr/lib/libgtest_main.a /usr/local/lib/libgtest_main.a

  build:
    commands:
      - echo Build started on `date`
      - echo Compiling the Python code...
      - python tests.py
      - echo installing deps for blackjack
      - sudo apt-get install libgtest-dev && cd /usr/src/gtest && sudo cmake CMakeLists.txt && sudo make && sudo cp lib/libgtest* /usr/lib/ && sudo mkdir /usr/local/lib/googletest && sudo ln -s /usr/lib/libgtest.a /usr/local/lib/libgtest.a && sudo ln -s /usr/lib/libgtest_main.a /usr/local/lib/libgtest_main.a
      - echo compiling blackjack code
      - mkdir build && cd build && cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-Werror" ..
      - cd build && make
  post_build:
    commands:
      - echo Build completed on `date`
artifacts:
  files:
    - app.py
    - appspec.yml
    - templates/base.html
    - templates/index.html
    - scripts/init.sh
    - scripts/start.sh
    - scripts/shutdown.py
    - scripts/requirements.txt
    - build/src/blackjack_run
